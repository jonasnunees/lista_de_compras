<!DOCTYPE html>
<!-- Declara√ß√£o do tipo de documento HTML5 -->
<html lang="pt-br">
<!-- In√≠cio do documento HTML com idioma definido como portugu√™s brasileiro -->

<head>
    <!-- Se√ß√£o HEAD cont√©m metadados e links para arquivos externos -->
    
    <!-- Define a codifica√ß√£o de caracteres para UTF-8 (suporta acentua√ß√£o) -->
    <meta charset="UTF-8">
    
    <!-- Configura a visualiza√ß√£o responsiva em dispositivos m√≥veis -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- T√≠tulo que aparece na aba do navegador -->
    <title>Supermercado Pro - Login</title>
    
    <!-- Link para o arquivo de estilos CSS externo -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Importa a biblioteca Supabase direto do CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Container principal centralizado -->
    <div class="container" style="margin-top: 50px;">
        <!-- Logo ou √≠cone do aplicativo -->
        <div style="text-align: center; font-size: 4rem; margin-bottom: 1rem;">
            üõí
        </div>
        
        <!-- T√≠tulo da p√°gina de login -->
        <h2>Supermercado Pro</h2>
        
        <!-- Subt√≠tulo -->
        <p style="text-align: center; color: var(--gray); margin-bottom: 2rem;">
            Controle suas compras de forma inteligente
        </p>

        <!-- Formul√°rio de Login -->
        <div id="login-form" class="auth-form">
            <h3>Entrar na sua conta</h3>
            
            <!-- Campo de email -->
            <div class="input-group">
                <label for="login-email">E-mail:</label>
                <input type="email" id="login-email" placeholder="seu@email.com" required>
            </div>
            
            <!-- Campo de senha -->
            <div class="input-group">
                <label for="login-password">Senha:</label>
                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>
            
            <!-- Bot√£o de login -->
            <button class="btn-add" onclick="handleLogin()">Entrar</button>
            
            <!-- Link para trocar para cadastro -->
            <p style="text-align: center; margin-top: 1rem; color: var(--gray);">
                N√£o tem uma conta? 
                <a href="#" onclick="toggleForms(); return false;" style="color: var(--primary); font-weight: bold;">
                    Cadastre-se
                </a>
            </p>
        </div>

        <!-- Formul√°rio de Cadastro (inicialmente oculto) -->
        <div id="signup-form" class="auth-form" style="display: none;">
            <h3>Criar nova conta</h3>
            
            <!-- Campo de nome -->
            <div class="input-group">
                <label for="signup-name">Nome completo:</label>
                <input type="text" id="signup-name" placeholder="Seu nome" required>
            </div>
            
            <!-- Campo de email -->
            <div class="input-group">
                <label for="signup-email">E-mail:</label>
                <input type="email" id="signup-email" placeholder="seu@email.com" required>
            </div>
            
            <!-- Campo de senha -->
            <div class="input-group">
                <label for="signup-password">Senha:</label>
                <input type="password" id="signup-password" placeholder="M√≠nimo 6 caracteres" required>
            </div>
            
            <!-- Campo de confirma√ß√£o de senha -->
            <div class="input-group">
                <label for="signup-confirm">Confirmar senha:</label>
                <input type="password" id="signup-confirm" placeholder="Digite a senha novamente" required>
            </div>
            
            <!-- Bot√£o de cadastro -->
            <button class="btn-add" onclick="handleSignup()">Criar conta</button>
            
            <!-- Link para trocar para login -->
            <p style="text-align: center; margin-top: 1rem; color: var(--gray);">
                J√° tem uma conta? 
                <a href="#" onclick="toggleForms(); return false;" style="color: var(--primary); font-weight: bold;">
                    Fa√ßa login
                </a>
            </p>
        </div>

        <!-- √Årea de loading (aparece durante autentica√ß√£o) -->
        <div id="loading" style="display: none; text-align: center; padding: 2rem;">
            <div style="font-size: 2rem;">‚è≥</div>
            <p style="color: var(--gray);">Aguarde...</p>
        </div>
    </div>

    <!-- Elemento de notifica√ß√£o (toast) -->
    <div id="notification"></div>

    <!-- Script de autentica√ß√£o -->
    <script>
        // 1. CONFIGURA√á√ÉO
        const SUPABASE_URL = 'https://vkgqxwcxnzuqjsgfzuau.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZrZ3F4d2N4bnp1cWpzZ2Z6dWF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDg3MDAsImV4cCI6MjA4MjI4NDcwMH0.vJnHuo9ORGBSgDPh6TlV8gBR6XjCzY6RYIe_zNjZ5I8';

        // Inicializa√ß√£o correta (evitando conflito com a vari√°vel global 'supabase')
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Esta fun√ß√£o agora ser√° "vista" pelo navegador
        function toggleForms() {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            
            if (loginForm.style.display !== 'none') {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            }
        }

        function showNotification(text, color) {
            const note = document.getElementById('notification');
            note.innerText = text;
            note.style.backgroundColor = color;
            note.style.display = 'block';
            setTimeout(() => note.style.display = 'none', 3000);
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            if (show) {
                loading.style.display = 'block';
                loginForm.style.display = 'none';
                signupForm.style.display = 'none';
            } else {
                loading.style.display = 'none';
                loginForm.style.display = 'block';
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Preencha todos os campos!', '#ef4444');
                return;
            }
            
            showLoading(true);
            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                if (error) throw error;
                showNotification('Login realizado!', '#16a34a');
                setTimeout(() => window.location.href = 'app.html', 1000);
            } catch (error) {
                showNotification('Email ou senha incorretos!', '#ef4444');
                showLoading(false);
            }
        }

        async function handleSignup() {
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            if (!name || !email || !password || !confirm) {
                showNotification('Preencha tudo!', '#ef4444');
                return;
            }
            
            if (password !== confirm) {
                showNotification('Senhas diferentes!', '#ef4444');
                return;
            }
            
            showLoading(true);
            try {
                // CORRIGIDO: Agora usando .signUp em vez de .signInWithPassword
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: { data: { full_name: name } }
                });
                
                if (error) throw error;
                showNotification('Conta criada! Confirme seu e-mail.', '#16a34a');
                setTimeout(() => { showLoading(false); toggleForms(); }, 2000);
            } catch (error) {
                showNotification(error.message, '#ef4444');
                showLoading(false);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const isSignup = document.getElementById('signup-form').style.display !== 'none';
                        isSignup ? handleSignup() : handleLogin();
                    }
                });
            });
        });
    </script>
</body>
</html>